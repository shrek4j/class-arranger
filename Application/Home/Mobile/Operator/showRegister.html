<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">  
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link ref="shortcut icon" href="/favicon.ico" type="image/x-icon"/>

    <title>芭蕉扇用户注册</title>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="/Public/css/weui/dist/style/weui.min.css"/>
    <link rel="stylesheet" href="/Public/css/bootstrap/sco/sco.message.css">
    <style type="text/css">

    </style>
    
</head>
<body class="global">
<div class="main-view">
    <div class="weui_cells_title" style="font-weight:bold;font-size:16px;">用户注册</div>
    <div class="weui_cells weui_cells_form">
        <div class="weui_cells_title" style="font-weight:bold;">选择地区</div>
        <div class="weui_cells">
            <div class="weui_cell weui_cell_select weui_select_after">
                <div class="weui_cell_hd">
                    <label for="" class="weui_label">省</label>
                </div>
                <div class="weui_cell_bd weui_cell_primary">
                    <select class="weui_select" name="selectProvince">
                        <foreach name="provinces" item="p">
                            <option value="{$p.region_id}">{$p.show_name}</option>
                        </foreach>
                    </select>
                </div>
            </div>
            <div class="weui_cell weui_cell_select weui_select_after">
                <div class="weui_cell_hd">
                    <label for="" class="weui_label">市</label>
                </div>
                <div class="weui_cell_bd weui_cell_primary">
                    <select class="weui_select" name="selectCity">
                        <option value="1">中国</option>
                        <option value="2">美国</option>
                        <option value="3">英国</option>
                    </select>
                </div>
            </div>
            <div class="weui_cell weui_cell_select weui_select_after">
                <div class="weui_cell_hd">
                    <label for="" class="weui_label">区</label>
                </div>
                <div class="weui_cell_bd weui_cell_primary">
                    <select class="weui_select" name="selectDistrict">
                        <option value="1">中国</option>
                        <option value="2">美国</option>
                        <option value="3">英国</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">机构（或个人）名称：</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="instName" type="string" pattern="*{1,20}" placeholder=""/>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">申请人名称：</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="applicant" type="string" pattern="*{1,20}" placeholder=""/>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">教授课程：</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="classType" type="string" pattern="*{1,20}" placeholder=""/>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">学生年龄段：</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="studentAges" type="string" pattern="*{1,20}" placeholder=""/>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">邮箱：</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="email" type="email" pattern="*{1,20}" placeholder=""/>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">微信：</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="wechat" type="string" pattern="*{1,20}" placeholder=""/>
            </div>
        </div>
        <div class="weui_cells_title bold-font" style="font-weight:bold;">备注：</div>
        <div class="weui_cells weui_cells_form">
            <div class="weui_cell">
                <div class="weui_cell_bd weui_cell_primary">
                    <textarea id="remark" class="weui_textarea" placeholder="请输入备注" rows="3"></textarea>
                    <div class="weui_textarea_counter"><span>0</span>/200</div>
                </div>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">生成用户名：</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="loginname" type="string" pattern="*{1,20}" placeholder=""/>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">生成密码：</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="password" type="string" pattern="*{1,20}" placeholder=""/>
            </div>
        </div>
        <div class="weui_cell">
            <div class="weui_cell_hd"><label class="weui_label">授权码：</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" id="confirmCode" type="string" pattern="*{1,20}" placeholder=""/>
            </div>
        </div>
    </div>
    <div class="weui_btn_area">
        <a class="weui_btn weui_btn_primary add-institution" href="javascript:;">确定</a>
    </div>
</div>

    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="/Public/js/bootstrap/sco/sco.message.js"></script>
    <script src="/Public/js/base.js"></script>

    <script type="text/javascript">
        $('#selectProvince').change(function(){
            var provinceId = $("#selectProvince").find("option:selected").val();

            $.ajax({
                type: "POST",
                url: "../Class/getClassTuitionInfo",
                data: "classId="+classId,
                success: function(msg){
                    if(msg != null){
                        var arr = msg.split("&");
                        $("#tuitionPerClass").val(arr[0]/100);
                        $("#unfinishedClassTimes").val(arr[1]);
                        $("#tuition").val((arr[0]/100)*arr[1]);
                    }
                }
            });
        });

        $("#loginname").blur(function(){
            var loginname = $("#loginname").val();
            $.ajax({
                type: "POST",
                url: "checkLoginname",
                data: "loginname="+loginname,
                success: function(msg){
                    if(msg == 'true'){
                        $.scojs_message('该用户名可用！', $.scojs_message.TYPE_OK);
                        return true;
                    }else{
                        $.scojs_message('该用户名已被使用！', $.scojs_message.TYPE_ERROR);
                        return false;
                    }
                }
            });
        });

        $(".add-institution").click(function(){
            var instName = $("#instName").val();
            var applicant = $("#applicant").val();
            var classType = $("#classType").val();
            var studentAges = $("#studentAges").val();
            var email = $("#email").val();
            var wechat = $("#wechat").val();
            var remark = $("#remark").val();
            var loginname = $("#loginname").val();
            var password = $("#password").val();
            var confirmCode = $("#confirmCode").val();

            $.ajax({
                type: "POST",
                url: "checkLoginname",
                data: "loginname="+loginname,
                success: function(msg1){
                    if(msg1 != 'true'){
                        $.scojs_message('该用户名已被使用！', $.scojs_message.TYPE_ERROR);
                    }else{
                        $.ajax({
                            type: "POST",
                            url: "doRegister",
                            data: "instName="+instName+"&applicant="+applicant+"&classType="+classType+
                                "&studentAges="+studentAges+"&email="+email+"&wechat="+wechat+
                                "&remark="+remark+"&loginname="+loginname+"&password="+password+"&confirmCode="+confirmCode,
                            success: function(msg2){
                                if(msg2 == 'true'){
                                    window.location.href="registerDone?loginname="+loginname+"&password="+password;
                                }else{
                                    $.scojs_message('保存失败！', $.scojs_message.TYPE_ERROR);
                                }
                            }
                        });
                    }
                }
            });
        });
    </script>
</body>
</html>
